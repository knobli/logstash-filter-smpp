# encoding: utf-8
require 'spec_helper'
require "logstash/filters/smpp"

describe LogStash::Filters::Smpp do
  describe "defaults" do
    let(:config) do <<-CONFIG
      filter {
        smpp {
        }
      }
    CONFIG
    end

    sample("payload" => "000000c200000005000000000000f0730001013439313531373330343137383700050063617232676f000400000000000000007969643a3130663665346264613063207375623a30303120646c7672643a303031207375626d697420646174653a3135313231303136313520646f6e6520646174653a3135313231303136313520737461743a44454c49565244206572723a3020746578743a5669656c656e2044616e6b2e2049687265204d690427000102001e000c313066366534626461306300") do
      expect(subject).to include("test")
      expect(subject['test']).to eq('bla')
    end
  end
  
  describe "when specifying source" do
    let(:config) do <<-CONFIG
      filter {
        smpp {
          source => "smpp_payload"
        }
      }
    CONFIG
    end

    sample("smpp_payload" => "000000c200000005000000000000f0730001013439313531373330343137383700050063617232676f000400000000000000007969643a3130663665346264613063207375623a30303120646c7672643a303031207375626d697420646174653a3135313231303136313520646f6e6520646174653a3135313231303136313520737461743a44454c49565244206572723a3020746578743a5669656c656e2044616e6b2e2049687265204d690427000102001e000c313066366534626461306300") do
      expect(subject).to include("test")
      expect(subject['test']).to eq('bla')
    end
  end
end
